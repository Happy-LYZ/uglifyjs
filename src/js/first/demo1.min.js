define(["uui","webAjax"],function(a,s){var e=function(a,e){this.app=a;this.constant=e};e.prototype.setCardEnable=function(a,e){a.isEditable(e);var t=this.app.getDataTables();for(var r in t){var i=t[r];if(i.gridId){this.app.getComp(i.gridId).setEnable(e)}else{i.setEnable(e)}}if(e){$(".viewCardBody  .gridTest .u-grid-header-link span").show()}else{$(".viewCardBody  .gridTest .u-grid-header-link span").hide()}};e.prototype.isHasData=function(){var a=false;var e=this.app.getDataTables();for(var t in e){var r=e[t];var i=r.getAllRows();if(i!=null){a=true;break}}return a};e.prototype.setDataTableRowStatus=function(a){var e=this.app.getDataTables();for(var t in e){var r=e[t];var i=r.getAllRows();for(var l=0,s=i.length;l<s;l++){i[l].setStatus(a)}}};e.prototype.getDataTableRowStatus=function(){var a=null;var e=this.app.getDataTables();for(var t in e){var r=e[t];var i=r.getAllRows();for(var l=0,s=i.length;l<s;l++){a=i[l].status;if(a!=="new"){return a}}}return a};e.prototype.getAllChangeValue=function(a){var e={};var t={};var r=this.app.getDataTables();for(var i in r){var l=r[i];if(l.id==="head"){var s=this.getAllChangeHeadValue(l);e.head=s}else{var o=this.getAllChangeBodyValue(l);t[l.id]=o}}e.bodys=t;e.oid=a;return e};e.prototype.getAllChangeHeadValue=function(a){var e={};e.name=a.id;e.pageInfo={currentPageIndex:a.pageIndex(),pageCount:a.totalPages(),pageSize:a.pageSize()};e.rows=new Array;var t=a.getChangedRows();var r=t.length;if(r==0){var i={};i.status=d(Row.STATUS.NORMAL);var l={};l["ts"]=this.getHeadValue("ts");l[this.constant.HID]=this.getHeadValue(this.constant.HID);i.values=l;e.rows.push(i);return e}for(var s=0,o=r;s<o;s++){var n=t[s].data;var i={};var u=t[s].status;i.status=d(u);var l={};for(var v in n){if(typeof n[v].value==undefined||n[v].value==null){continue}l[v]={};for(var p in n[v].meta){if(p==="display"){l[v].display=n[v].meta.display}else if(p==="precision"){l[v].precision=n[v].meta.precision}}if(!n[v].meta){n[v].display=n[v].value;l[v].display=n[v].value}l[v].value=n[v].value;i.values=l}e.rows.push(i)}return e};e.prototype.getAllChangeBodyValue=function(a){var e={};e.name=a.id;e.pageInfo={currentPageIndex:a.pageIndex(),pageCount:a.totalPages(),pageSize:a.pageSize()};e.rows=new Array;var t=a.getChangedRows();var r=t.length;if(r==0){var t=a.getAllRows();var r=t.length;for(var i=0,l=r;i<l;i++){var s={};var o={};o.rowId=t[i].rowId;o.status=d(Row.STATUS.NORMAL);s["ts"]=this.getBodyValueByRowIndex(i,"ts");s[this.constant.BID]=this.getBodyValueByRowIndex(i,this.constant.BID);o.values=s;e.rows.push(o)}return e}for(var i=0,l=r;i<l;i++){var o={};var n={};o.status=d(t[i].status);o.rowId=t[i].rowId;var u=t[i].data;for(var v in u){n[v]={};for(var p in u[v].meta){if(p==="display"){n[v].display=u[v].meta.display}else if(p==="precision"){n[v].precision=u[v].meta.precision}}if(u[v].meta==undefined||u[v].meta.display==undefined){u[v].display=u[v].value;n[v].display=u[v].value}n[v].value=u[v].value;o.values=n}e.rows.push(o)}return e};e.prototype.isHasChange=function(){var a=false;var e=this.app.getDataTables();var t=this.getDataTableRowStatus();if(t==="new"){a=true}else{for(var r in e){var i=e[r];var l=i.getChangedRows();if(l!=null&&l.length>0){a=true;break}}}return a};e.prototype.getAllUIValue=function(a){var e={};var t={};var r=this.app.getDataTables();for(var i in r){var l=r[i];if(l.id==="head"){var s=this.getAllHeadValue(l);e.head=s}else{var o=this.getAllBodyUIValue(l);t[l.id]=o}}e.bodys=t;e.oid=a;return e};e.prototype.getAllValueForDel=function(a){var e=this.getAllValue(a);var t=e.bodys;for(var r in t){t[r].rows=[]}var i=e.head.rows[0].values;var l={};for(var r in i){if(r===this.constant.HID||r===this.constant.TS){l[r]=i[r]}}e.head.rows[0].values=l;return e};e.prototype.getAllValue=function(a){var e={};var t={};var r=this.app.getDataTables();for(var i in r){var l=r[i];if(l.id==="head"){var s=this.getAllHeadValue(l);e.head=s}else{var o=this.getAllBodyValue(l);t[l.id]=o}}e.bodys=t;e.oid=a;return e};e.prototype.getAllHeadValue=function(a){var e={};e.name=a.id;e.pageInfo={currentPageIndex:a.pageIndex(),pageCount:a.totalPages(),pageSize:a.pageSize()};e.rows=new Array;var t=a.getAllRows();for(var r=0,i=t.length;r<i;r++){var l=t[r].data;var s={};s.status=d(t[r].status);var o={};for(var n in l){o[n]={};for(var u in l[n].meta){if(u==="display"){o[n].display=l[n].meta.display}else if(u==="precision"){o[n].precision=l[n].meta.precision}}if($("#"+n).attr("type")==="checkbox"&&l[n].value===null){l[n].value="N"}o[n].value=l[n].value;s.values=o}e.rows.push(s)}return e};e.prototype.getAllBodyUIValue=function(a){var e={};e.name=a.id;e.pageInfo={currentPageIndex:a.pageIndex(),pageCount:a.totalPages(),pageSize:a.pageSize()};e.rows=new Array;var t=a.getAllRows();var r=t.length;for(var i=0,l=r;i<l;i++){var s={};var o={};s.status=d(t[i].status);if(t[i].status===Row.STATUS.FALSE_DELETE){continue}s.rowId=t[i].rowId;var n=t[i].data;for(var u in n){if(typeof n[u].value==undefined||n[u].value==null){continue}o[u]={};for(var v in n[u].meta){if(v==="display"){o[u].display=n[u].meta.display}else if(v==="precision"){o[u].precision=n[u].meta.precision}}o[u].value=n[u].value;s.values=o}e.rows.push(s)}return e};e.prototype.getAllBodyValue=function(a){var e={};e.name=a.id;e.pageInfo={currentPageIndex:a.pageIndex(),pageCount:a.totalPages(),pageSize:a.pageSize()};e.rows=new Array;var t=a.getAllRows();var r=t.length;for(var i=0,l=r;i<l;i++){var s={};var o={};s.status=d(t[i].status);s.rowId=t[i].rowId;var n=t[i].data;for(var u in n){o[u]={};for(var v in n[u].meta){if(v==="display"){o[u].display=n[u].meta.display}else if(v==="precision"){o[u].precision=n[u].meta.precision}}o[u].value=n[u].value;s.values=o}e.rows.push(s)}return e};var d=function(a){var e=0;if(a===Row.STATUS.NORMAL){e=0}else if(a===Row.STATUS.UPDATE){e=1}else if(a===Row.STATUS.NEW){e=2}else if(a===Row.STATUS.FALSE_DELETE){e=3}return e};e.prototype.setAllValue=function(a){var e=a;var t=e.head;var r=e.bodys;this.setAllHeadValue(t);this.setAllBodyValue(r)};e.prototype.setAllHeadValue=function(a){var e=a.name;if(e==null){e="head"}var t=a.rows;var r=this.app.getDataTable(e);var i=r.getCurrentRow();if(i==null){i=r.createEmptyRow()}for(var l=0;l<t.length;l++){var s=t[l].values;for(var o in s){if(r.meta.hasOwnProperty(o)){var n=r.getMeta(o).DataType;var u=r.getMeta(o).controltype;if((n=="date"||n=="u-date"||n=="UFDate")&&s[o].value){if(u=="refRelation"){if(s[o].display){s[o].display=s[o].display.substring(0,10)}}else{if(s[o].value){s[o].value=s[o].value.substring(0,10)}}}}}this.setRowValue(i,s)}};e.prototype.setAllBodyValue=function(a){for(var e in a){var t=a[e];var r=e;var i=t.pageInfo;var l=t.rows;var s=this.app.getDataTable(r);var o=s.getAllRows();var n=o.length;for(var u=0;u<l.length;u++){var v={unSelect:true};var p;if(n==0){p=s.createEmptyRow(v)}else{p=o[u]}var d=l[u].values;for(var e in d){if(s.meta.hasOwnProperty(e)){var f=s.getMeta(e).DataType;var g=s.getMeta(e).controltype;if((f=="date"||f=="u-date"||f=="UFDate")&&d[e].value){if(g=="refRelation"){if(d[e].display){d[e].display=d[e].display.substring(0,10)}}else{if(d[e].value){d[e].value=d[e].value.substring(0,10)}}}}}this.setRowValue(p,l[u].values)}}};e.prototype.setAllBodyCellValue=function(a,e){for(var t in a){if(t="bodys"){var r=a[t];var i=t;var l=r[e].pageInfo;var s=r[e].rows;var o=this.app.dataTables[e];var n=o.getAllRows();for(var u=0;u<s.length;u++){var v=n[u];if(v==null){var p={unSelect:true};v=o.createEmptyRow(p)}this.setRowValue(v,s[u].values)}}}};e.prototype.addBodyValue=function(a){for(var e in a){var t=a[e];var r=e;var i=t.rows;var l=this.app.getDataTable(r);for(var s=0;s<i.length;s++){var o={unSelect:true};var n=l.createEmptyRow(o);this.setRowValue(n,i[s].values)}}};e.prototype.setRowValue=function(a,e){for(var t in e){if(!a.data[t]){continue}this.setRowValueByField(a,t,e[t])}};e.prototype.setRowValueByField=function(a,e,t){window.valueChange=false;if(t.precision!=undefined&&t.precision!=null){if(parseFloat(t.precision)>=0&&parseFloat(t.precision)<20){a.setMeta(e,"precision",t.precision)}}var r=t.display;var i=t.value;if(r!==undefined){a.setMeta(e,"display",r)}else{a.setMeta(e,"display",null)}if(i!==undefined){a.setValue(e,null);a.setValue(e,i)}else{a.setValue(e,null)}window.valueChange=true};e.prototype.setHeadValue=function(a,e){var t=this.app.getDataTables();for(var r in t){var i=t[r];if(i.id==="head"){var l=i.getCurrentRow();if(l==null||typeof l==undefined){return null}this.setRowValueByField(l,a,e)}}};e.prototype.setSearchValue=function(a,e){var t=this.app.getDataTables();for(var r in t){var i=t[r];if(JSON.stringify(i.meta)!=="{}"){var l=i.getCurrentRow();l.setMeta(a,"display",e);l.setMeta(a,"precision",e);l.setValue(a,e)}}};e.prototype.getHeadValue=function(a){var e=this.app.getDataTables();if(e==null){return null}var t={};for(var r in e){var i=e[r];if(i.id==="head"){var l=i.getCurrentRow();if(l==null||typeof l==undefined){return null}t.value=l.getValue(a);t.display=l.getMeta(a,"display");t.precision=l.getMeta(a,"precision");return t}}};e.prototype.setBodyValueByRowId=function(a,e,t){var r=this.app.getDataTables();for(var i in r){var l=r[i];if(l.id!=="head"){var s=l.getRowByRowId(a);if(s!=undefined&&s!=null){this.setRowValueByField(s,e,t)}break}}};e.prototype.getBodyValueByRowId=function(a,e){var t=this.app.getDataTables();for(var r in t){var i=t[r];if(i.id!=="head"){var l=i.getRowByRowId(a);var s={};s.display=l.getMeta(e,"display");s.value=l.getValue(e);s.precision=l.getMeta(e,"precision");return s}}};e.prototype.setBodyValueByRowIndex=function(a,e,t){var r=this.app.getDataTables();for(var i in r){var l=r[i];if(l.id!=="head"){var s=l.getRow(a);this.setRowValueByField(s,e,t)}}};e.prototype.getBodyValueByRowIndex=function(a,e){var t=this.app.getDataTables();for(var r in t){var i=t[r];if(i.id!=="head"){var l=i.getRow(a);var s={};s.display=l.getMeta(e,"display");s.value=l.getValue(e);s.precision=l.getMeta(e,"precision");return s}}};e.prototype.getRowDataByIndex=function(a){var e=this.app.getDataTables();for(var t in e){var r=e[t];if(r.id!=="head"){var i=r.getRow(a);return i.data}}};e.prototype.getRowChangedDataByIndex=function(a){var e=this.getRowDataByIndex(a);var t=new Array;for(var r in e){var i=e[r];if(i.changed){t[r]=i}}return t};e.prototype.getSelectedRowData=function(){var a=this.app.getDataTables();for(var e in a){var t=a[e];if(t.id!=="head"){var r=t.getFocusRow();return r.data}}};e.prototype.getInitPageParams=function(){var a=this.getHeadValue(this.constant.HID);if(a==null||a=="undefined"){return null}var e={type:"detail",id:a.value};return e};e.prototype.getSelectedDelData=function(a){var e=a.dataTable.getSelectedRows();var t=a.dataTable.getSelectedIndexs();var r=new Array;var i={};if(e.length>0&&t.length>0){for(var l=0;l<e.length;l++){r.push(o(e[l]))}i=r}return i};function o(a){var e={};var t={};var r=l(a);e.oid="0001Z810000000006YU5";e.head=r;var i=n(a);t.body=i;e.bodys=t;return e}function l(a){var e={};e.name="head";e.pageInfo={currentPageIndex:0,pageCount:0,pageSize:0};e.rows=new Array;var t={};var r={};for(var i in a.data){if(i==="crevecontid"||i==="ts"){r[i]={};r[i].display=a.data[i].value;r[i].value=a.data[i].value;r[i].precision=0}}t.values=r;e.rows.push(t);return e}function n(a){var e={};e.name="";e.pageInfo={currentPageIndex:0,pageCount:0,pageSize:0};e.rows=new Array;e.rows.push(null);return e}e.prototype.resetAllValue=function(){var a=this.app.getDataTables();var e=this;for(var t in a){var r=a[t];r.resetAllValue()}var i=this.getHeadValue(this.constant.HID);if(i!=null){var l=this.getAllValue(this.constant.templateID);s.send(ctx+"platform/pubapp/billcard_loadrelation.do",l,false,function(a){if(a.success){e.setAllValue(a.data)}});this.setDataTableRowStatus(Row.STATUS.NORMAL)}};e.prototype.clearAllData=function(){var a=[];var e=this.app.getDataTables();for(var t in e){var r=e[t];var i=r.getAllRows();for(var l=0,s=i.length;l<s;l++){var o=i[l].data;for(var t in o){var n=o[t];if(n&&n["changed"]){o[t]["changed"]=false;i[l].setValue(t,null);i[l].setMeta(t,"display",null);if(n.baseValue){n.baseValue=null}}}if(i[l].status=="new"){a.push(l)}}r.removeRows(a)}};e.prototype.getHeadTable=function(){var a=this.app.getDataTables();for(var e in a){if(e==="head"||e==="searchTable"){var t=a[e];return t}}};e.prototype.getBodyTables=function(){var a=this.app.getDataTables();var e=[];for(var t in a){if(t!="head"&&t!="searchTable"){e.push(a[t])}}return e};e.prototype.setHeadItemEditable=function(a,e){var t=this.app.getDataTables();for(var r in t){if(r==="head"||r==="searchTable"){var i=t[r];var l=i.meta;for(var s in l){if(a===s){i.setMeta(a,"enable",e);if(!e){if($("#"+a).attr("type")==="checkbox"){$("#"+a).parent().parent("div[u-meta]").css({"background-color":"rgba(241, 241, 241,0.54)"}).addClass("unEditable")}else{$("#"+a).css({"background-color":"rgba(241, 241, 241,0.54)"}).addClass("unEditable")}$("#"+a).attr("disabled",true).prev(".u-input-group-before").css({display:"none"})}else{if($("#"+a).attr("type")==="checkbox"){$("#"+a).parent().parent("div[u-meta]").css({"background-color":"rgba(241, 241, 241,0.54)"}).removeClass("unEditable");if($("#"+a).parent().parent("div[u-meta]").hasClass("is-disabled")){$("#"+a).parent().parent("div[u-meta]").removeClass("is-disabled")}}else{$("#"+a).css({"background-color":"rgb(255, 255, 255)"}).removeClass("unEditable")}$("#"+a).attr("disabled",false).prev(".u-input-group-before").css({display:"block"})}}}}}};e.prototype.setBodyListEditable=function(a,e){var t=this.app.getDataTables();for(var r in t){if(r!=="head"){var i=t[r];var l=i.meta;for(var s in l){if(a===s){i.setMeta(a,"enable",e)}}}}};e.prototype.setBodyRowEditable=function(a,e){var t=this.app.getDataTables();for(var r in t){if(r!=="head"){var i=t[r];var l=i.meta;var s=i.getRow(a);for(var o in l){s.setMeta(o,"enable",e)}}}};e.prototype.setBodyCellEditable=function(a,e,t){var r=this.app.getDataTables();for(var i in r){if(i!=="searchTable"){var l=r[i];var s=l.meta;var o=l.getRow(a);for(var n in s){if(e===n){o.setMeta(e,"enable",t)}}}}};e.prototype.afterEditGetJsonValue=function(a,e){var t=a.field;var r=a.dataTable;var i={};i.cellName=t;var l=this.getAllValue(this.constant.templateID);i.card=l;var s=new Array;var o=new Array;if(r==="head"){s=l.head.rows}else{i.tabName=r;i.cellValues=o;if(e!==undefined&&e!==null){for(var n=0;n<e.length;n++){var u=this.app.getDataTable(r).getRowByRowId(e[n]);u.values=u.data;s.push(u)}}else{var u=this.app.getDataTable(r).getCurrentRow();u.values=u.data;s.push(u)}}for(var n=0;n<s.length;n++){var v=s[n].values;var p={};var d=s[n].rowId;p.rowId=s[n].rowId;p.newValue={value:v[t].value,precision:v[t].precision,display:v[t].display};if(typeof v[t].basevalue=="undefined"){v[t].basevalue=null}var f;if(n==0){f=a.oldValue}p.oldValue={value:f,precision:v[t].precision,display:""};o.push(p)}if(r=="head"){i.newValue=o[0].newValue;i.oldValue=o[0].oldValue}return i};e.prototype.refMulAddRows=function(a,e){var t=e.getValue(a);var r=e.getMeta(a,"display");if(t!=undefined&&t!=null&&t.split(",").length>1){for(var i=0;i<t.split(",").length;i++){if(i==0){e.setMeta(a,"precision",0);e.setMeta(a,"display",r.split(",")[i]);e.setValue(a,t.split(",")[i])}else{var l=this.viewModel.dataTable.getFocusIndex()+i;this.viewModel.dataTable.insertRow(l);var s=this.viewModel.dataTable.getRow(l);s.setMeta(a,"precision",0);s.setMeta(a,"display",r.split(",")[i]);s.setValue(a,t.split(",")[i])}}}};e.prototype.afterEditGetAjaxValue=function(a,e){var t=this;var r=function(a){if(a.success){var e=a.data;t.setAllValue(e)}else{console.log(a)}};s.send(a,e,false,r)};return e});